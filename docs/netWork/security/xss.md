# XSS

> Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全

#### XSS分类

1. 存储型
	* 概念：存储型XSS又被称为持久性XSS，它是最危险的一种跨站脚本，相比反射型XSS和DOM型XSS具有更高的隐蔽性，所以危害更大，它不需要用户手动触发
	* 攻击步骤：
    	1. 击者将恶意代码提交到目标网站的数据库中
        2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器
        3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行
        4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作
    * 攻击方法：常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等
    	
2. 反射型
	* 概念：反射型XSS也被称为非持久性XSS。发出请求时，XSS代码出现在URL中，最后输入提交到服务器，服务器解析后在响应内容中出现这段XSS代码，最后浏览器解析执行
	* 攻击步骤：
    	1. 攻击者构造出特殊的 URL，其中包含恶意代码
        2. 户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器
        3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行
        4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作
    * 攻击方法：常见于通过 URL 传递参数的功能，如网站搜索、跳转等
3. DOM型
	* 概念：DOM 型 XSS 攻击中，**取出和执行**恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于**服务端**的安全漏洞
	* 攻击步骤：
    	1. 攻击者构造出特殊的 URL，其中包含恶意代码
        2. 用户打开带有恶意代码的 URL
        3. 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行
        4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作
    * 攻击方法：DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。在使用 .innerHTML、.outerHTML、document.write() 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 .textContent、.setAttribute() 等。如果用 Vue/React 技术栈，并且不使用 v-html/dangerouslySetInnerHTML 功能，就在前端 render 阶段避免 innerHTML、outerHTML 的 XSS 隐患。DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，\<a> 标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。
    
#### 如何避免

1. 对输入(和URL参数)进行过滤，对输出进行编码。
2. 内容安全策略（内容安全策略）
 > CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置

#### 参考文章

1. [如何防止XSS攻击?](https://tech.meituan.com/2018/09/27/fe-security.html)
2. [Content Security Policy 入门教程](http://www.ruanyifeng.com/blog/2016/09/csp.html)
